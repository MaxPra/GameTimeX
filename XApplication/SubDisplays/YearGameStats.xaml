<Window
    x:Class="GameTimeX.XApplication.SubDisplays.YearGameStats"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="Year Game Stats"
    Width="980"
    Height="640"
    MinWidth="820"
    MinHeight="520"
    AllowsTransparency="True"
    Background="Transparent"
    Loaded="Window_Loaded"
    MouseLeftButtonDown="Window_MouseLeftButtonDown"
    Style="{StaticResource DefaultWindowStyle}"
    WindowStartupLocation="CenterOwner"
    WindowStyle="None"
    mc:Ignorable="d">

    <WindowChrome.WindowChrome>
        <WindowChrome
            CaptionHeight="0"
            CornerRadius="0"
            GlassFrameThickness="0" />
    </WindowChrome.WindowChrome>

    <Border
        Background="#2F2F2F"
        BorderBrush="{DynamicResource ButtonDefaultBrush}"
        BorderThickness="1"
        CornerRadius="12"
        SnapsToDevicePixels="True">

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="30" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!--  Titlebar  -->
            <Border
                Grid.Row="0"
                Background="Black"
                ClipToBounds="True"
                CornerRadius="12,12,0,0" />
            <TextBlock
                Grid.Row="0"
                Margin="10,0,0,0"
                VerticalAlignment="Center"
                Foreground="White"
                Text="{Binding HeaderText}" />

            <StackPanel
                Grid.Row="0"
                HorizontalAlignment="Right"
                Orientation="Horizontal">
                <Button
                    x:Name="btnClose"
                    Width="40"
                    Height="30"
                    Background="Transparent"
                    BorderBrush="Transparent"
                    Click="btnClose_Click"
                    Content="X"
                    Foreground="White"
                    Style="{StaticResource NoMouseOverButtonStyle}">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border
                                x:Name="bg"
                                Background="{TemplateBinding Background}"
                                CornerRadius="0,12,0,0">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="bg" Property="Background" Value="Red" />
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="bg" Property="Background" Value="#CC0000" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </StackPanel>

            <!--  Header above grid  -->
            <Grid Grid.Row="1" Margin="18,16,18,6">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!--  Cool line  -->
                <TextBlock
                    Grid.Column="0"
                    FontStyle="Italic"
                    Foreground="#BBBBBB"
                    Text="As the year draws to a close, here’s your playtime rewind — every game you touched this year."
                    TextWrapping="Wrap" />

                <StackPanel
                    Grid.Column="1"
                    VerticalAlignment="Center"
                    Orientation="Horizontal">
                    <TextBlock
                        Margin="0,0,14,0"
                        Foreground="#DDDDDD"
                        Text="{Binding ElementName=dgGames, Path=Items.Count, StringFormat=Items: {0}}" />
                    <TextBlock Foreground="#DDDDDD" Text="{Binding TotalHoursLastYear, StringFormat=Total hours last year: {0:0.0} h}" />
                </StackPanel>
            </Grid>

            <!--  List  -->
            <Border
                Grid.Row="2"
                Margin="18"
                Background="#3A3A3A"
                BorderBrush="#20FFFFFF"
                BorderThickness="1"
                CornerRadius="10">
                <DataGrid
                    x:Name="dgGames"
                    AutoGenerateColumns="False"
                    CanUserAddRows="False"
                    CanUserDeleteRows="False"
                    IsReadOnly="True"
                    ItemsSource="{Binding Games}"
                    RowHeight="60"
                    Style="{StaticResource SteamDataGrid}">

                    <DataGrid.Columns>
                        <!--  Cover  -->
                        <DataGridTemplateColumn Width="68" Header="">
                            <DataGridTemplateColumn.CellStyle>
                                <Style BasedOn="{StaticResource SteamDataGridCell}" TargetType="DataGridCell">
                                    <Setter Property="Padding" Value="4" />
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                    <Setter Property="VerticalContentAlignment" Value="Center" />
                                </Style>
                            </DataGridTemplateColumn.CellStyle>
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border
                                        Width="52"
                                        Height="52"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Center"
                                        Background="#222"
                                        BorderBrush="#20FFFFFF"
                                        BorderThickness="1"
                                        CornerRadius="6">
                                        <Image Source="{Binding CoverUri}" Stretch="UniformToFill">
                                            <Image.Style>
                                                <Style TargetType="Image">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding CoverUri}" Value="{x:Null}">
                                                            <Setter Property="Source" Value="{StaticResource MyImageSource}" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding CoverUri}" Value="">
                                                            <Setter Property="Source" Value="{StaticResource MyImageSource}" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Image.Style>
                                        </Image>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!--  Name  -->
                        <DataGridTextColumn
                            Width="*"
                            Binding="{Binding Title}"
                            Header="Game">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                                    <Setter Property="VerticalAlignment" Value="Center" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!--  Total time overall  -->
                        <DataGridTextColumn
                            Width="130"
                            Binding="{Binding HoursTotalOverall, StringFormat={}{0:0.0}}"
                            Header="Total Hours">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Left" />
                                    <Setter Property="VerticalAlignment" Value="Center" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!--  Hours last year  -->
                        <DataGridTextColumn
                            Width="150"
                            Binding="{Binding HoursLastYear, StringFormat={}{0:0.0}}"
                            Header="Hours Last Year">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Left" />
                                    <Setter Property="VerticalAlignment" Value="Center" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>

            <!--  Footer  -->
            <Grid Grid.Row="3" Margin="18,0,18,18">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Button
                    x:Name="btnCloseBottom"
                    Grid.Column="1"
                    Width="140"
                    Height="40"
                    Click="btnClose_Click"
                    Content="Close"
                    Style="{StaticResource NormalGuiButton}" />
            </Grid>
        </Grid>
    </Border>
</Window>
